---
import Layout from "@/layouts/Layout.astro"
import { supabaseClient } from "@/supabase/client"
---

<Layout title="Authenticating" />

<script type="module" is:inline>
  async function handleAuthCallback() {
    const urlParams = new URLSearchParams(window.location.search)
    const code = urlParams.get("code")
    const state = urlParams.get("state")

    if (code) {
      try {
        const { error } = await supabaseClient.auth.exchangeCodeForSession(code)

        if (error) {
          console.error(error)
          return
        }

        window.location.href = "/"
      } catch (error) {
        console.error(error)
      }
    } else {
      console.error("Authorization code not found")
    }
  }

  handleAuthCallback()
</script>
