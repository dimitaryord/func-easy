---
import Layout from "@/layouts/Layout.astro"
import { supabaseClient } from "@/supabase/client"
---

<Layout title="Authenticating" />

<script type="module" is:inline>
  async function handleAuthCallback() {
    const urlFragment = window.location.hash.substring(1)
    const params = new URLSearchParams(urlFragment)

    const accessToken = params.get("access_token")
    const refreshToken = params.get("refresh_token")
    const providerToken = params.get("provider_token")
    const expiresIn = params.get("expires_in")

    if (accessToken) {
      try {
        const { error } = await supabaseClient.auth.setSession({
          access_token: accessToken,
          refresh_token: refreshToken,
          expires_in: parseInt(expiresIn),
        })

        if (error) {
          console.error("Error setting session:", error)
          return
        }

        window.location.href = "/"
      } catch (error) {
        console.error("Error during authentication:", error)
      }
    } else {
      console.error("Access token not found in the URL fragment")
    }
  }

  handleAuthCallback()
</script>
